<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>大王叫我来巡山哦、咿而哟咿儿咿儿哟～</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://freehyan.github.io/"/>
  <updated>2020-03-08T10:11:12.203Z</updated>
  <id>http://freehyan.github.io/</id>
  
  <author>
    <name>freehyan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>基于物理的大气散射 (一)</title>
    <link href="http://freehyan.github.io/2020/03/05/sky-rendering-1/"/>
    <id>http://freehyan.github.io/2020/03/05/sky-rendering-1/</id>
    <published>2020-03-05T13:20:01.000Z</published>
    <updated>2020-03-08T10:11:12.203Z</updated>
    
    <content type="html"><![CDATA[<p><img src="http://q6qyzne7s.bkt.clouddn.com/blog/20200306090955.png" alt=""></p><p>当你看到蓝天白云，日落黄昏，有没有想过这些现象产生的原因是什么？这些物理现象用一句话解释，由于大气层中的参与介质发生了光散射现象，从而形成了天空颜色。</p><a id="more"></a><h5 id="参与介质"><a href="#参与介质" class="headerlink" title="参与介质"></a>参与介质</h5><p>什么是参与介质？假设光的能量是由光子组成，空气中与光子进行交互的细小的粒子就被称为参与介质。比如空气中的水分子，以及工厂排放的气溶胶粒子。</p><h5 id="光散射"><a href="#光散射" class="headerlink" title="光散射"></a>光散射</h5><p>什么是光散射现象？光源的辐射度沿着路径前行时，碰到参与介质时会发生三个不同散射现象的行为:</p><ul><li>吸收（Absobption）： 参与介质把光能量转换为其他形式的能量。</li><li>外散射（Out-Scattering）： 改变光传播方向。</li><li>内散射（In-Scattering）：进入相机方向的入射辐射度。</li></ul><p><img src="http://q6qyzne7s.bkt.clouddn.com/blog/20200308150248.png" width="50%" /></p><h5 id="大气物理模型"><a href="#大气物理模型" class="headerlink" title="大气物理模型"></a>大气物理模型</h5><p>如何推导出大气现象背后的物理模型，首先假设大气层只存在一次单散射现象，即视线路径上只发生一次散射。</p><p><img src="http://q6qyzne7s.bkt.clouddn.com/blog/20200308110143.png" width="50%" /></p><p>如图，太阳光到达大气层并没有能量损失，在$C$点的光通量为$I_{s}$。由于单散射，路径$CP$上不会发生散射，但是会有光照强度损失，P点的光强为$I_{p} = I_{s}T(\overline{CP})$。在P点的光强只有一部分能量才会转向相机，那么P点散射函数与哪些因素有关呢？</p><pre><code>* 角度：相机方向与太阳太阳的夹角。* 高度：高度不同，粒子的密度值不同。* 波长：波长较小的光分量更容易被散射。</code></pre><p>散射函数细化之后，可由后面文章的函数组合来表示P点的散射现象。</p><h5 id="散射系数"><a href="#散射系数" class="headerlink" title="散射系数"></a>散射系数</h5><p>散射系数与粒子的大小，折射率有关。根据粒子大小不同可分为瑞利散射系数和米散射系数。</p><p><img src="http://q6qyzne7s.bkt.clouddn.com/blog/20200308122322.png" width="60%" /></p><h6 id="瑞利散射系数？"><a href="#瑞利散射系数？" class="headerlink" title="瑞利散射系数？"></a>瑞利散射系数？</h6><p>因为小分子的大小远小于光线波长，这造成了光的波长会影响瑞利散射效果，因此瑞利散射是<strong>波长相关</strong>。上图左边瑞利散射几乎均匀向四面八方散射光强，这也是白天时候瑞利散射把波长较小的蓝色光向天空四面八方散射造成蓝天效果。</p><p> $ \beta_{R}(\lambda) = 8\pi^3\frac{(n^2-1)^2}{3N_{e}\lambda^4} $</p><p>其中，$n$是空气的折射率，约等于(1.0003)；$N_{e}$是海平面的空气密度,约为2.545e25；$\lambda$是入射光的波长.经过计算，瑞利散射系数可表示为$\beta_{R}^{s}.rgb = (5.8,13.5,33.1)10^{-6}m^{-1}$。</p><h6 id="米散射系数？"><a href="#米散射系数？" class="headerlink" title="米散射系数？"></a>米散射系数？</h6><p>米散射系数很难去推导计算，基于统计数据的结果，米散射系数可以常量进行估计。[BN08]论文中，米散射系数值为$\beta_{M}^{s} = (2,2,2)10^{-6}m^{-1}$。</p><h5 id="相位函数"><a href="#相位函数" class="headerlink" title="相位函数"></a>相位函数</h5><p>相位函数表示太阳光发生散射现象时转向相机方向的概率函数。</p><ol><li><p>瑞利相位函数<br>$F_{R}(\theta) = \frac{3}{4}(1+cos\theta) $</p></li><li><p>米相位函数</p></li></ol><p>米散射相位函数更加复杂，分布变化与粒子大小有关。[CS92]改善了Henyey-Greenstein函数，用来近似计算米散射相位函数。</p><p>$F_{M}(\theta, g) = \frac{3(1-g^2)}{2(2+g^2)}\frac{1+\cos^2(\theta)}{(1+g^2-2g\cos^2(\theta))^{3/2}}$</p><h5 id="密度函数"><a href="#密度函数" class="headerlink" title="密度函数"></a>密度函数</h5><p>根据散射系数和相位函数，我们可以计算海平面的散射值。但是随着海拔高度的增加，空气中的粒子密度是发生变换的，而密度函数是用来估计任意高度下粒子的密度。</p><p>$p_{R,M}(h) = exp(-\frac{h}{H_{R,M}})$</p><p>其中，h是以海平面为基准的额高度，其中瑞利和米散射海平面基准高度为$H_{R}$8000米，$H_{M}$为1200米。</p><p>太阳光通过大气层最终进入视野的只有内散射的光通量，而根据参与介质的类型不同可分为两种散射现象。水分子相关的散射为瑞利散射，气溶胶相关的为米散射。</p><h5 id="透射比函数"><a href="#透射比函数" class="headerlink" title="透射比函数"></a>透射比函数</h5><p>现在只能确定太阳光转向相机方向的光通量，除了方向还需要计算光强的衰减。计算透射函数之前先了解光学深度的概念。</p><h6 id="光学深度"><a href="#光学深度" class="headerlink" title="光学深度"></a>光学深度</h6><p><img src="http://q6qyzne7s.bkt.clouddn.com/blog/20200308144510.png" width="60%" /></p><p>光学深度本质是积分函数，可理解为光强经过长度路径AB后，被空气分子或粒子吸收和外散射后，损失的光通量部分。</p><p>$D(A-&gt;B) = \int_{A}^{B} (\beta_{R}^{e}e^{-h(t)/H_{R}} + \beta_{M}^{e}e^{-h(t)/H_{M}})dt $</p><p>其中，瑞利散射和米散射的光学深度是相互独立且可分别计算，其中散射系数$\beta_{R/M}^{s}$是海平面的数值，还需要被密度函数$e^{-h/H_{R/M}}$进行缩放。光学深度根据公式来看，就是瑞利散射和米散射<strong>消光系数和密度函数乘积的积分</strong>。</p><ul><li>瑞利散射消光系数: $\beta_{R}^{e} = \beta_{R}^{s}$，消光系数等于散射系数。</li><li>米散射消光系数： $\beta_{M}^{e} = \beta_{M}^{s} + \beta_{M}^{a}$，[BN08]论文中建议米散射吸收系数等于散射系数的0.1倍。</li></ul><p>透射函数的衰减非线性衰减，也是指数衰减形式，并与光学深度紧密联系。<br>$T(A-&gt;B) = exp^{-D} $</p><h5 id="散射积分"><a href="#散射积分" class="headerlink" title="散射积分"></a>散射积分</h5><p><img src="http://q6qyzne7s.bkt.clouddn.com/blog/20200307164630.png" width="50%" /></p><p>上面部分都只考虑了相机方向P点的散射，但是视线方向AB上有无数的P点，通过积分拟合把视线路径AB拆分为无数的线段距离，就可以计算出整个路径上的内散射积分和。</p><p>$L_{In} = \int_{C}^{O}L_{Sun}e^{-T(A(s)-&gt;P(s))}e^{-T(P(s)-&gt;C)} * V(P(s))(\beta_{R}^{s}e^{-h(s)/H_{R}}p_{R}(\theta)+\beta_{M}^{s}e^{-h(s)/H_{M}}p_{M}(\theta)) ds$</p><h6 id="大气透视"><a href="#大气透视" class="headerlink" title="大气透视"></a>大气透视</h6><p>当看远处的山时，发现会有一种雾蒙蒙的感觉，这是由于远山在视线的路径上发生了透射衰减，此现象也被称为大气透视。以图中O点举例，即O点入射辐射度为自身对象辐射度的衰减和内散射光的积分之和，计算公式为：</p><p>$L = L_{O}e^{-T(O-&gt;C)} + L_{In}$</p><p>大气雾的计算由此而来。</p><h5 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h5><ol><li>GPU Pro 5: High Performance Outdoor Light Scattering Using Epipolar Sampling.</li><li>Precomputed Atmospheric Scattering</li><li>Rendering Parametrizable Planetary Atmospheres with Multiple Scattering in Real-Time</li><li><a href="http://hyperphysics.phy-astr.gsu.edu/hbase/atmos/blusky.html" target="_blank" rel="noopener">Blue Sky</a></li><li><a href="https://zhuanlan.zhihu.com/p/36498679" target="_blank" rel="noopener">基于物理的大气渲染</a></li><li><a href="https://zhuanlan.zhihu.com/p/32525403" target="_blank" rel="noopener">基于体积的大气散射</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://q6qyzne7s.bkt.clouddn.com/blog/20200306090955.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;当你看到蓝天白云，日落黄昏，有没有想过这些现象产生的原因是什么？这些物理现象用一句话解释，由于大气层中的参与介质发生了光散射现象，从而形成了天空颜色。&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Atmospheric Scattering" scheme="http://freehyan.github.io/tags/Atmospheric-Scattering/"/>
    
  </entry>
  
  <entry>
    <title>咸鱼翻身计划</title>
    <link href="http://freehyan.github.io/2020/03/01/salted-fish-turn-over-plan-md/"/>
    <id>http://freehyan.github.io/2020/03/01/salted-fish-turn-over-plan-md/</id>
    <published>2020-03-01T13:59:37.000Z</published>
    <updated>2020-03-08T10:15:03.497Z</updated>
    
    <content type="html"><![CDATA[<p>不知不觉当中，我参加工作已经有一年半的时间（当咸鱼的时间）。虽然工作中有了很多的收获，但是课余时间都拿来玩游戏了，想想就觉得颓废。疫情之后就开始学习计划吧，看书读报写代码。</p><a id="more"></a><h5 id="书籍"><a href="#书籍" class="headerlink" title="书籍"></a>书籍</h5><ul><li>[ ] Real-Time Rendering </li><li>[ ] Physically Based Rendering, From The Theory to Implementation</li><li>[ ] 全局光照技术</li><li>[ ] 游戏引擎架构</li><li><p>[ ] 游戏设计模式</p></li><li><p>[ ] GPU Gems 1</p></li><li>[ ] GPU Gems 2</li><li><p>[ ] GPU Gems 3</p></li><li><p>[ ] GPU Pro 1</p></li><li>[ ] GPU Pro 2</li><li>[ ] GPU Pro 3</li><li>[ ] GPU Pro 4</li><li>[ ] GPU Pro 5</li><li>[ ] GPU Pro 6</li><li>[ ] GPU Pro 7</li></ul><h5 id="工程"><a href="#工程" class="headerlink" title="工程"></a>工程</h5><ul><li>[ ] Soft Rendering</li><li>[ ] Rendering Engine</li></ul><h5 id="引擎"><a href="#引擎" class="headerlink" title="引擎"></a>引擎</h5><ul><li>[ ] Unity</li><li>[ ] Unreal</li></ul><h5 id="三月"><a href="#三月" class="headerlink" title="三月"></a>三月</h5><ul><li>[ ] Terrain Rendering</li><li>[ ] Ocean Rendering</li><li>[ ] Physically Based Rendering, Chapter 2</li><li>[ ] Physically Based Rendering, Chapter 3</li></ul><h5 id="四月"><a href="#四月" class="headerlink" title="四月"></a>四月</h5><h5 id="五月"><a href="#五月" class="headerlink" title="五月"></a>五月</h5><h5 id="六月"><a href="#六月" class="headerlink" title="六月"></a>六月</h5><h5 id="七月"><a href="#七月" class="headerlink" title="七月"></a>七月</h5><h5 id="八月"><a href="#八月" class="headerlink" title="八月"></a>八月</h5><h5 id="九月"><a href="#九月" class="headerlink" title="九月"></a>九月</h5><h5 id="十月"><a href="#十月" class="headerlink" title="十月"></a>十月</h5><h5 id="十一月"><a href="#十一月" class="headerlink" title="十一月"></a>十一月</h5><h5 id="十二月"><a href="#十二月" class="headerlink" title="十二月"></a>十二月</h5>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;不知不觉当中，我参加工作已经有一年半的时间（当咸鱼的时间）。虽然工作中有了很多的收获，但是课余时间都拿来玩游戏了，想想就觉得颓废。疫情之后就开始学习计划吧，看书读报写代码。&lt;/p&gt;
    
    </summary>
    
    
    
      <category term="Others" scheme="http://freehyan.github.io/tags/Others/"/>
    
  </entry>
  
</feed>
